<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="Untitled">
  <BehaviorTree ID="Untitled">
    <Fallback>
      <ReactiveSequence>
        <TimeToComplete ttc="{ttc}"/>
        <Fallback>
          <CheckBattery/>
          <Sequence>
            <GoToDestination name="Go to Recharge Station"
                             x="0"
                             y="0"/>
            <WaitFullBattery/>
            <GoToDestination name="Go Back to Room"
                             x="5"
                             y="1"/>
          </Sequence>
        </Fallback>
        <Fallback>
          <CheckEquipments has_equipments="{has_equipments}"/>
          <Sequence>
            <GoToDestination name="Go To Storage"
                             x="7"
                             y="1"/>
            <PickEquipments has_equipments="{has_equipments}"/>
            <GoToDestination name="Go Back to Room"
                             x="5"
                             y="1"/>
          </Sequence>
        </Fallback>
        <Sequence>
          <IsRoomFree/>
          <GoToDestination name="Go to Room"
                           x="5"
                           y="1"/>
          <Sequence>
            <Fallback>
              <MoveFurniture/>
              <SendMessageToManager message="fail: move furniture"/>
            </Fallback>
            <Fallback>
              <VacuumFloor/>
              <SendMessageToManager message="fail: Vacuum floor"/>
            </Fallback>
            <Fallback>
              <WipeFloor/>
              <SendMessageToManager message="fail: wipe floor"/>
            </Fallback>
            <Fallback>
              <SterilizeFurniture/>
              <SendMessageToManager message="fail: Sterilize furniture"/>
            </Fallback>
          </Sequence>
          <GoToDestination name="Go To Recharge Station"
                           x="0"
                           y="0"/>
        </Sequence>
      </ReactiveSequence>
      <Sequence>
        <SendMessageToManager message="fail: Mission aborted"/>
        <AbortMission/>
      </Sequence>
    </Fallback>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="AbortMission"
            editable="true"/>
    <Condition ID="CheckBattery"
               editable="true"/>
    <Condition ID="CheckEquipments"
               editable="true">
      <input_port name="has_equipments"/>
    </Condition>
    <Action ID="GoToDestination"
            editable="true">
      <input_port name="x"/>
      <input_port name="y"/>
    </Action>
    <Condition ID="IsRoomFree"
               editable="true"/>
    <Action ID="MoveFurniture"
            editable="true"/>
    <Action ID="PickEquipments"
            editable="true">
      <output_port name="has_equipments"/>
    </Action>
    <Action ID="SendMessageToManager"
            editable="true">
      <input_port name="message"/>
    </Action>
    <Action ID="SterilizeFurniture"
            editable="true"/>
    <Action ID="TimeToComplete"
            editable="true">
      <output_port name="ttc"/>
    </Action>
    <Action ID="VacuumFloor"
            editable="true"/>
    <Action ID="WaitFullBattery"
            editable="true"/>
    <Action ID="WipeFloor"
            editable="true"/>
  </TreeNodesModel>

</root>
