<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4"
      main_tree_to_execute="Untitled">
  <BehaviorTree ID="Untitled">
    <Sequence>
      <Sequence>
        <SetBlackboard output_key="has_equipments" value="True" />
        <SetBlackboard output_key="is_room_free" value="True" />
        <SetBlackboard output_key="recharge_x" value="0.0" />
        <SetBlackboard output_key="recharge_y" value="0.0" />
        <SetBlackboard output_key="room_x" value="0.0" />
        <SetBlackboard output_key="room_y" value="3.0" />
        <SetBlackboard output_key="storage_x" value="-2.0" />
        <SetBlackboard output_key="storage_y" value="2.0" />
      </Sequence>
      <Fallback>
        <ReactiveSequence>
          <TimeToComplete ttc="{ttc}"/>
          <Fallback>
            <CheckBattery/>
            <Sequence>
              <GoToDestination name="Go to Recharge Station"
                               x="{recharge_x}"
                               y="{recharge_y}"/>
              <WaitFullBattery/>
              <GoToDestination name="Go Back to Room"
                               x="{room_x}"
                               y="{room_y}"/>
            </Sequence>
          </Fallback>
          <Fallback>
            <CheckEquipments has_equipments="{has_equipments}"/>
            <Sequence>
              <GoToDestination name="Go To Storage"
                               x="{storage_x}"
                               y="{storage_y}"/>
              <PickEquipments has_equipments="{has_equipments}"/>
              <GoToDestination name="Go Back to Room"
                               x="{room_x}"
                               y="{room_y}"/>
            </Sequence>
          </Fallback>
          <Sequence>
            <IsRoomFree is_room_free="{is_room_free}"/>
            <GoToDestination name="Go to Room"
                             x="{room_x}"
                             y="{room_y}"/>
            <Sequence>
              <Fallback>
                <MoveFurniture/>
                <SendMessageToManager message="fail: move furniture"/>
              </Fallback>
              <Fallback>
                <VacuumFloor/>
                <SendMessageToManager message="fail: Vacuum floor"/>
              </Fallback>
              <Fallback>
                <WipeFloor/>
                <SendMessageToManager message="fail: wipe floor"/>
              </Fallback>
              <Fallback>
                <SterilizeFurniture/>
                <SendMessageToManager message="fail: Sterilize furniture"/>
              </Fallback>
            </Sequence>
            <GoToDestination name="Go To Recharge Station"
                             x="{recharge_x}"
                             y="{recharge_y}"/>
          </Sequence>
        </ReactiveSequence>
        <Sequence>
          <SendMessageToManager message="fail: Mission aborted"/>
          <AbortMission/>
        </Sequence>
      </Fallback>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="AbortMission"
            editable="true"/>
    <Condition ID="CheckBattery"
               editable="true"/>
    <Condition ID="CheckEquipments"
               editable="true">
      <input_port name="has_equipments"/>
    </Condition>
    <Action ID="GoToDestination"
            editable="true">
      <input_port name="x"/>
      <input_port name="y"/>
    </Action>
    <Condition ID="IsRoomFree"
               editable="true">
      <input_port name="is_room_free"/>
    </Condition>
    <Action ID="MoveFurniture"
            editable="true"/>
    <Action ID="PickEquipments"
            editable="true">
      <output_port name="has_equipments"/>
    </Action>
    <Action ID="SendMessageToManager"
            editable="true">
      <input_port name="message"/>
    </Action>
    <Action ID="SterilizeFurniture"
            editable="true"/>
    <Action ID="TimeToComplete"
            editable="true">
      <output_port name="ttc"/>
    </Action>
    <Action ID="VacuumFloor"
            editable="true"/>
    <Action ID="WaitFullBattery"
            editable="true"/>
    <Action ID="WipeFloor"
            editable="true"/>
  </TreeNodesModel>

</root>
